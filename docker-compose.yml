version: '3.8'

#local:docker
services:
    #nodejs Service
    app:
        build:
            context: .
            dockerfile: ./node/Dockerfile
        container_name: app
        volumes:
            - ./src:/usr/app/src
            - /usr/app/src/node_modules
            # - /src/node_modules:/usr/app/src/node_modules
        ports: 
            - 49160:3000
        networks:
            - app-network
        depends_on: 
            - db

    #mongodb Service
    db:
        image: mongo:5.0-focal
        container_name: db
        restart: unless-stopped
        env_file: .env
        environment:
            - MONGO_INITDB_ROOT_USERNAME=$MONGODB_USERNAME
            - MONGO_INITDB_ROOT_PASSWORD=$MONGODB_PASSWORD
            - MONGO_INITDB_DATABASE=$MONGODB_DB
        ports:
            - $MONGODB_LOCAL_PORT:$MONGODB_DOCKER_PORT
        volumes:
            - dbdata:/data/db
        networks:
            - app-network

#Docker Networks
networks:
    app-network:
        driver: bridge

#Volumes
volumes:
    dbdata: